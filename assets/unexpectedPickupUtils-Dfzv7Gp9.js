import{s as y,f}from"./index-BjROJruB.js";async function g(n,l){try{console.log("ğŸ” Analyse des laboratoires Ã©ligibles pour location:",n);const e=l||new Date,r=e.getHours();let o;r<12?(o=new Date(e),o.setDate(o.getDate()-1),console.log(`ğŸŒ™ TournÃ©e de nuit - heure actuelle: ${r}h, date de tournÃ©e: ${f(o)} (veille - heure locale)`)):r>=15?(o=new Date(e),console.log(`â˜€ï¸ TournÃ©e de jour - heure actuelle: ${r}h, date de tournÃ©e: ${f(o)} (jour actuel - heure locale)`)):(o=new Date(e),console.log(`ğŸ”„ PÃ©riode transition - heure actuelle: ${r}h, date de tournÃ©e: ${f(o)} (jour actuel - heure locale)`));const{data:t,error:a}=await y.from("laboratory_clients").select(`
        id,
        laboratory_id,
        location_id,
        name,
        laboratories!inner(
          id,
          name
        )
      `).eq("location_id",n);if(a)throw new Error(`Erreur lors de la rÃ©cupÃ©ration des clients lab: ${a.message}`);if(!t||t.length===0)return console.log("âŒ Aucun laboratory_client trouvÃ© pour cette location"),[];console.log("ğŸ” Structure des donnÃ©es labClients:",JSON.stringify(t,null,2)),console.log(`ğŸ“‹ ${t.length} laboratory_clients trouvÃ©s:`,t.map(s=>({laboratoryId:s.laboratory_id,laboratories:s.laboratories,client:s.name})));const i=[];for(const s of t)if(await b(s.laboratory_id,n,o)){const c=s.laboratories?.name||"Lab sans nom";console.log(`âŒ ${c} n'est pas Ã©ligible (retour programmÃ©)`)}else{const c=s.laboratories?.name||"Lab sans nom";i.push({id:s.laboratory_id,name:c,laboratory_client_id:s.id,client_name:s.name||"Client sans nom"}),console.log(`âœ… ${c} est Ã©ligible (pas de retour programmÃ©)`)}return console.log(`ğŸ¯ RÃ©sultat: ${i.length} laboratoires Ã©ligibles sur ${t.length}`),i}catch(e){return console.error("âŒ Erreur dans getEligibleLabsForUnexpectedPickup:",e),[]}}async function b(n,l,e){try{const r=f(e);console.log("ğŸ” VÃ©rification retour programmÃ© et unexpected pour labo:",{laboratoryId:n,locationId:l,todayStr:`${r} (heure locale)`});const{data:o,error:t}=await y.from("lab_tour_shipments").select(`
        id,
        shipment_type,
        scheduled_date,
        lab_tour_id,
        lab_tours!inner(
          laboratory_id
        )
      `).eq("lab_tours.laboratory_id",n).eq("from_location_id",l).eq("shipment_type","client_to_lab").eq("scheduled_date",r);if(t)return console.error("Erreur lors de la vÃ©rification des shipments:",t),!1;if(o&&o.length>0)return console.log(`âŒ ${o.length} shipment(s) client_to_lab programmÃ©(s) trouvÃ©(s) - laboratoire NON Ã©ligible`),!0;const{data:a,error:i}=await y.from("driver_route_shipments").select(`
        id,
        laboratory_id,
        pickup_stop_id,
        driver_route_stops!inner(
          id,
          location_id
        ),
        unexpected,
        created_at
      `).eq("laboratory_id",n).eq("driver_route_stops.location_id",l).eq("unexpected",!0).gte("created_at",r+"T00:00:00Z").lt("created_at",r+"T23:59:59Z");if(i)console.error("Erreur lors de la vÃ©rification des unexpected shipments:",i);else if(a&&a.length>0)return console.log(`âŒ ${a.length} unexpected shipment(s) dÃ©jÃ  crÃ©Ã©(s) aujourd'hui - laboratoire NON Ã©ligible`),!0;return console.log("âœ… Aucun shipment programmÃ© ni unexpected crÃ©Ã© - laboratoire Ã‰LIGIBLE"),!1}catch(r){return console.error("Erreur lors de la vÃ©rification du pickup programmÃ©:",r),!1}}async function h(n){console.log("ğŸ§ª Test de la fonction getEligibleLabsForUnexpectedPickup"),console.log("ğŸ“ Location ID:",n);const l=await g(n);return console.log("ğŸ¯ RÃ©sultats:"),l.length===0?console.log("âŒ Aucun laboratoire Ã©ligible"):l.forEach((e,r)=>{console.log(`${r+1}. ${e.name} (client: ${e.client_name})`)}),l}async function S(n,l,e,r,o,t){try{console.log("ğŸ“¦ CrÃ©ation shipment rÃ©cupÃ©ration inattendue:",{routeId:n,pickupStopId:l,laboratoryId:e,laboratoryClientId:r,proofPhotoUrl:o,shipmentRef:t});const{data:a,error:i}=await y.rpc("add_unexpected_shipment",{p_route_id:n,p_pickup_stop_id:l,p_laboratory_id:e,p_laboratory_client_id:r,p_proof_photo_url:o,p_shipment_ref:t});if(i)throw new Error(`Erreur lors de la crÃ©ation du shipment: ${i.message}`);if(!a||a.length===0)throw new Error("Aucune donnÃ©e retournÃ©e par la fonction add_unexpected_shipment");const s=a[0];return console.log("âœ… Shipment crÃ©Ã© avec succÃ¨s:",s),{shipmentId:s.shipment_id,deliveryStopId:s.delivery_stop_id,deliveryStopType:s.delivery_stop_type}}catch(a){return console.error("âŒ Erreur lors de la crÃ©ation du shipment inattendu:",a),null}}async function m(n,l,e,r,o,t){try{console.log("ğŸ†• [createUnexpectedSmart] DÃ©but crÃ©ation shipment intelligent:",{routeId:n.slice(-8),pickupStopId:l.slice(-8),laboratoryId:e.slice(-8),laboratoryClientId:r.slice(-8)});let a=[];if(typeof window<"u"&&window.store)a=window.store.route.rawStops||[],console.log("ğŸ” [createUnexpectedSmart] Stops rÃ©cupÃ©rÃ©s du store:",a.length);else{console.log("âš ï¸ [createUnexpectedSmart] Store non disponible, rÃ©cupÃ©ration depuis Supabase...");const{data:p,error:_}=await y.from("driver_route_stops").select("*").eq("route_id",n).order("stop_order");if(_)throw new Error(`Erreur rÃ©cupÃ©ration stops: ${_.message}`);a=p||[],console.log("ğŸ” [createUnexpectedSmart] Stops rÃ©cupÃ©rÃ©s de Supabase:",a.length)}const i=await u(e,l,a);console.log("ğŸ¯ [createUnexpectedSmart] Delivery stop dÃ©terminÃ©:",i);const s={route_id:n,pickup_stop_id:l,delivery_stop_id:i.deliveryStopId,laboratory_id:e,laboratory_client_id:r,shipment_type:"client_pickup",pickup_status:"completed",delivery_status:i.deliveryStopType==="client_same"?"completed":"pending",proof_photo_url:o,shipment_ref:t||`RÃ©cupÃ©ration inattendue ${new Date().toISOString().slice(0,16)}`,unexpected:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("ğŸ“¦ [createUnexpectedSmart] DonnÃ©es shipment Ã  crÃ©er:",{...s,route_id:s.route_id.slice(-8),pickup_stop_id:s.pickup_stop_id.slice(-8),delivery_stop_id:s.delivery_stop_id.slice(-8),laboratory_id:s.laboratory_id.slice(-8)});const{data:d,error:c}=await y.from("driver_route_shipments").insert([s]).select("id").single();if(c)throw new Error(`Erreur crÃ©ation shipment: ${c.message}`);if(!d)throw new Error("Aucune donnÃ©e retournÃ©e aprÃ¨s crÃ©ation du shipment");return console.log("âœ… [createUnexpectedSmart] Shipment crÃ©Ã© avec succÃ¨s:",{shipmentId:d.id,deliveryStopType:i.deliveryStopType,explanation:i.explanation}),{shipmentId:d.id,deliveryStopId:i.deliveryStopId,deliveryStopType:i.deliveryStopType,explanation:i.explanation}}catch(a){return console.error("âŒ [createUnexpectedSmart] Erreur lors de la crÃ©ation:",a),null}}async function v(n,l=!0){try{console.log("ğŸ§ª === TEST FLUX COMPLET RÃ‰CUPÃ‰RATION INATTENDUE ==="),console.log("ğŸ“ Location testÃ©e:",n),console.log(`
ğŸ” Ã‰tape 1 : Recherche des laboratoires Ã©ligibles...`);const e=await g(n);if(e.length===0){console.log("âŒ Aucun laboratoire Ã©ligible trouvÃ© - fin du test");return}console.log(`âœ… ${e.length} laboratoires Ã©ligibles trouvÃ©s:`),e.forEach((o,t)=>{console.log(`  ${t+1}. ${o.name} (client: ${o.client_name})`)});const r=e[0];console.log(`
ğŸ“¦ Ã‰tape 2 : Test crÃ©ation shipment pour ${r.name}...`),console.log("âš ï¸  Test crÃ©ation shipment simulÃ© (nÃ©cessite route et stop rÃ©els)"),console.log("ParamÃ¨tres qui seraient utilisÃ©s:"),console.log("  - Laboratory ID:",r.id),console.log("  - Laboratory Client ID:",r.laboratory_client_id),console.log("  - Nom du laboratoire:",r.name),console.log("  - Client:",r.client_name),console.log(`
âœ… === TEST TERMINÃ‰ AVEC SUCCÃˆS ===`)}catch(e){console.error("âŒ Erreur pendant le test:",e)}}async function T(n,l){try{console.log("ğŸ” Recherche laboratory_client_id:",{laboratoryId:n,locationId:l});const{data:e,error:r}=await y.from("laboratory_clients").select("id").eq("laboratory_id",n).eq("location_id",l).limit(1);if(r)return console.error("âŒ Erreur lors de la recherche laboratory_client:",r),null;if(!e||e.length===0)return console.warn("âš ï¸ Aucun laboratory_client trouvÃ© pour:",{laboratoryId:n,locationId:l}),null;const o=e[0].id;return console.log("âœ… Laboratory_client_id trouvÃ©:",o),o}catch(e){return console.error("âŒ Erreur dans findLaboratoryClientId:",e),null}}async function I(){try{if(console.log("ğŸ§ª === TEST RÃ‰CUPÃ‰RATION INATTENDUE AVEC VRAIES DONNÃ‰ES ==="),typeof window>"u"||!window.store){console.error("âŒ Fonction Ã  appeler depuis la console du navigateur avec une route active");return}const n=window.store;if(!n.route.driverRoute||!n.route.isActive){console.error("âŒ Aucune route active trouvÃ©e");return}const l=n.route.driverRoute.id,e=n.route.groupedStops[n.route.currentStopIndex];if(!e){console.error("âŒ Aucun stop actuel trouvÃ©");return}console.log("ğŸ“ DonnÃ©es de route actuelle:",{routeId:l,currentStopIndex:n.route.currentStopIndex,stopId:e.id,locationId:e.location_id,originalStopIds:e.originalStopIds}),console.log(`
ğŸ” Test recherche laboratoires Ã©ligibles...`);const r=await g(e.location_id);if(r.length===0){console.log("âŒ Aucun laboratoire Ã©ligible - fin du test");return}console.log(`âœ… ${r.length} laboratoires Ã©ligibles:`,r);const o=r[0];console.log(`
ğŸ” Test recherche laboratory_client_id pour ${o.name}...`);const t=await T(o.id,e.location_id);if(!t){console.error("âŒ Impossible de trouver laboratory_client_id");return}console.log("âœ… Laboratory_client_id trouvÃ©:",t),console.log(`
ğŸ“¦ Simulation crÃ©ation shipment...`),console.log("ParamÃ¨tres qui seraient utilisÃ©s:",{routeId:l,pickupStopId:e.originalStopIds[0],laboratoryId:o.id,laboratoryClientId:t,proofPhotoUrl:"https://test-photo.jpg",shipmentRef:`Test rÃ©cupÃ©ration inattendue ${o.name}`}),console.log("âœ… === TEST TERMINÃ‰ - PRÃŠT POUR IMPLÃ‰MENTATION ===")}catch(n){console.error("âŒ Erreur pendant le test:",n)}}async function E(n,l,e,r){try{console.log("ğŸ§ª === TEST CRÃ‰ATION SHIPMENT RÃ‰CUPÃ‰RATION INATTENDUE ===");const o=n||"393394ea-ffad-492f-a726-2f20cdd7e3fc",t=l||"bb0afb77-e2f8-4217-b5a8-c488052c09a1",a=e||"78ce06b9-3c16-44c4-8fcf-7c3269aff93a",i=r||"1ff61893-0d88-4c89-8ddc-68d38384b9da";console.log("ğŸ“‹ ParamÃ¨tres du test:",{routeId:o,pickupStopId:t,laboratoryId:a,laboratoryClientId:i});const s=await S(o,t,a,i,"https://test-photo-console.jpg","Test crÃ©ation depuis console");s?(console.log("âœ… Shipment crÃ©Ã© avec succÃ¨s !"),console.log("ğŸ“¦ DÃ©tails:",s),console.log(`
ğŸ¯ VÃ©rification dans Supabase:`),console.log(`   SELECT * FROM driver_route_shipments WHERE id = '${s.shipmentId}';`)):console.error("âŒ Ã‰chec de la crÃ©ation du shipment"),console.log(`
âœ… === TEST TERMINÃ‰ ===`)}catch(o){console.error("âŒ Erreur lors du test:",o)}}async function w(n){try{console.log("ğŸ†• === TEST FONCTION RETOUR - NOUVELLE ARCHITECTURE ==="),console.log("ğŸ“ Location testÃ©e:",n),console.log(`
ğŸ” Ã‰tape 1: Recherche laboratoires Ã©ligibles...`);const l=await g(n);if(console.log(`ğŸ“Š RÃ©sultat: ${l.length} laboratoires Ã©ligibles:`,l.map(e=>({nom:e.name,clientId:e.laboratory_client_id,labId:e.id}))),l.length===0){console.log("âŒ Aucun laboratoire Ã©ligible - arrÃªt du test");return}if(typeof window<"u"&&window.store){const e=window.store;console.log(`
ğŸ” Ã‰tape 2: Validation avec tournÃ©e actuelle...`),console.log("ğŸ“Š Informations tournÃ©e:",{isActive:e.route.isActive,rawStopsCount:e.route.rawStops.length,rawShipmentsCount:e.route.rawShipments.length,groupedStopsCount:e.route.groupedStops.length});const r=e.route.rawStops.filter(o=>o.stop_type==="client"&&o.client_actions&&(o.client_actions==="pickup"||o.client_actions==="delivery"||o.client_actions==="both"));if(r.length>0){console.log("ğŸ†• Stops nouvelle architecture dÃ©tectÃ©s:",{count:r.length,examples:r.slice(0,3).map(t=>({id:t.id.slice(-8),type:t.stop_type,actions:t.client_actions,locationId:t.location_id.slice(-8)}))});const o=r.find(t=>t.location_id===n);if(o){console.log("âœ… Stop correspondant trouvÃ© pour test:",{stopId:o.id.slice(-8),actions:o.client_actions,completed:o.completed});const t=e.route.rawShipments.filter(a=>a.pickup_stop_id===o.id||a.delivery_stop_id===o.id);console.log("ğŸ“¦ Shipments associÃ©s au stop:",{count:t.length,pickups:t.filter(a=>a.pickup_stop_id===o.id).length,deliveries:t.filter(a=>a.delivery_stop_id===o.id).length,types:[...new Set(t.map(a=>a.shipment_type))]})}}else console.log("âš ï¸ Aucun stop nouvelle architecture dÃ©tectÃ© - peut Ãªtre en mode legacy")}console.log(`
âœ… === TEST TERMINÃ‰ ===`),console.log("ğŸ¯ Conclusion: La fonction retour est compatible avec la nouvelle architecture !")}catch(l){console.error("âŒ Erreur pendant le test nouvelle architecture:",l)}}async function x(n,l,e,r,o){try{console.log("ğŸš€ [createSmartUnexpected] DÃ©but crÃ©ation retour inattendu intelligent");const t=await m(n,l,e,r,o);return t?t.deliveryStopType==="client_same"?(console.log("âœ… [createSmartUnexpected] Shipment bouclÃ© sur client, aucun stop Ã  crÃ©er"),{success:!0,shipmentId:t.shipmentId,deliveryStopId:t.deliveryStopId,deliveryStopType:t.deliveryStopType,explanation:t.explanation+" - Shipment marquÃ© comme completed automatiquement"}):(console.log("âœ… [createSmartUnexpected] Shipment crÃ©Ã© avec destination:",t.deliveryStopType),{success:!0,shipmentId:t.shipmentId,deliveryStopId:t.deliveryStopId,deliveryStopType:t.deliveryStopType,explanation:t.explanation}):{success:!1,deliveryStopId:l,deliveryStopType:"client_same",explanation:"Ã‰chec de la crÃ©ation du shipment",error:"Erreur lors de la crÃ©ation du shipment"}}catch(t){return console.error("âŒ [createSmartUnexpected] Erreur:",t),{success:!1,deliveryStopId:l,deliveryStopType:"client_same",explanation:"Erreur lors de la crÃ©ation",error:t instanceof Error?t.message:"Erreur inconnue"}}}async function u(n,l,e){try{console.log("ğŸ” [findDeliveryStop] Recherche delivery stop pour:",{laboratoryId:n.slice(-8),pickupStopId:l.slice(-8),totalStops:e.length});const r=e.find(t=>(t.stop_type==="lab_dropoff"||t.stop_type==="laboratory")&&t.laboratory_id===n);if(r)return console.log("âœ… [findDeliveryStop] Lab dropoff trouvÃ©:",{stopId:r.id.slice(-8),stopType:r.stop_type,laboratoryId:r.laboratory_id?.slice(-8)}),{deliveryStopId:r.id,deliveryStopType:"lab_dropoff",explanation:`Lab dropoff trouvÃ© pour laboratoire ${n.slice(-8)}`};const o=e.find(t=>t.stop_type==="depot_dropoff"||t.stop_type==="depot");return o?(console.log("âœ… [findDeliveryStop] Depot dropoff trouvÃ©:",{stopId:o.id.slice(-8),stopType:o.stop_type}),{deliveryStopId:o.id,deliveryStopType:"depot_dropoff",explanation:"Depot dropoff utilisÃ© comme fallback"}):(console.log("âš ï¸ [findDeliveryStop] Aucun dropoff trouvÃ©, utilisation du mÃªme stop client"),{deliveryStopId:l,deliveryStopType:"client_same",explanation:"Aucun dropoff disponible, shipment bouclÃ© sur le client pour completion"})}catch(r){return console.error("âŒ [findDeliveryStop] Erreur:",r),{deliveryStopId:l,deliveryStopType:"client_same",explanation:"Erreur rencontrÃ©e, fallback sur le client"}}}async function L(n){try{if(console.log("ğŸ§ª === TEST LOGIQUE INTELLIGENTE RETOUR INATTENDU ==="),typeof window>"u"||!window.store){console.error("âŒ Test doit Ãªtre lancÃ© depuis la console navigateur avec tournÃ©e active");return}const l=window.store,e=l.route.rawStops||[],r=l.route.driverRoute;if(!r||e.length===0){console.error("âŒ Aucune tournÃ©e active trouvÃ©e");return}console.log("ğŸ“Š DonnÃ©es tournÃ©e:",{routeId:r.id.slice(-8),totalStops:e.length,stopTypes:[...new Set(e.map(i=>i.stop_type))]});const o=n||e.find(i=>i.stop_type==="client"||i.stop_type==="client_pickup")?.id;if(!o){console.error("âŒ Aucun stop client trouvÃ© pour le test");return}const t=[{name:"Laboratoire avec dropoff existant",laboratoryId:e.find(i=>i.stop_type==="lab_dropoff")?.laboratory_id||"lab-with-dropoff-id"},{name:"Laboratoire sans dropoff (mais depot existe)",laboratoryId:"lab-without-dropoff-id"},{name:"Laboratoire sans dropoff ni depot",laboratoryId:"lab-no-destination-id"}];console.log(`
ğŸ¯ Test des scÃ©narios:`);for(const i of t){console.log(`
--- ${i.name} ---`);const s=await u(i.laboratoryId,o,e);console.log("RÃ©sultat:",{deliveryStopType:s.deliveryStopType,deliveryStopId:s.deliveryStopId.slice(-8),explanation:s.explanation,isSameAsPickup:s.deliveryStopId===o})}console.log(`
ğŸ“‹ Analyse des stops disponibles:`);const a={labDropoffs:e.filter(i=>i.stop_type==="lab_dropoff"||i.stop_type==="laboratory").length,depotDropoffs:e.filter(i=>i.stop_type==="depot_dropoff"||i.stop_type==="depot").length,clients:e.filter(i=>i.stop_type==="client"||i.stop_type.includes("client")).length,autres:e.filter(i=>!["lab_dropoff","laboratory","depot_dropoff","depot","client"].some(s=>i.stop_type.includes(s))).length};console.log("Types de stops:",a),console.log(`
âœ… === TEST TERMINÃ‰ ===`),console.log("ğŸ¯ La logique intelligente fonctionne correctement pour tous les scÃ©narios !")}catch(l){console.error("âŒ Erreur pendant le test:",l)}}async function R(){try{if(console.log("ğŸ§ª === TEST RETOUR INATTENDU INTELLIGENT ==="),typeof window>"u"||!window.store){console.error("âŒ Lancer ce test depuis la console navigateur avec une tournÃ©e active");return}const n=window.store,l=n.route.driverRoute,e=n.route.rawStops||[];if(!l||e.length===0){console.error("âŒ Aucune tournÃ©e active trouvÃ©e");return}console.log("ğŸ“Š Ã‰tat de la tournÃ©e:",{routeId:l.id.slice(-8),totalStops:e.length,currentStopIndex:n.route.currentStopIndex,isActive:n.route.isActive});const r=e.reduce((c,p)=>(c[p.stop_type]=(c[p.stop_type]||0)+1,c),{});console.log("ğŸ“‹ Types de stops dans la tournÃ©e:",r);const o=e.find(c=>c.stop_type==="client"||c.stop_type==="client_pickup"||c.stop_type==="client_delivery");if(!o){console.warn("âš ï¸ Aucun stop client trouvÃ© pour le test");return}console.log("ğŸ¯ Stop client sÃ©lectionnÃ© pour test:",{stopId:o.id.slice(-8),stopType:o.stop_type,locationId:o.location_id?.slice(-8),completed:o.completed,clientActions:o.client_actions}),console.log(`
ğŸ” === TEST DES SCÃ‰NARIOS DE DESTINATION ===`);const t=e.find(c=>c.stop_type==="lab_dropoff"||c.stop_type==="laboratory");if(t){console.log(`
--- ScÃ©nario 1: Laboratoire avec dropoff existant ---`);const c=t.laboratory_id||"test-lab-with-dropoff-id",p=await u(c,o.id,e);console.log("âœ… RÃ©sultat scÃ©nario 1:",{deliveryStopType:p.deliveryStopType,deliveryStopId:p.deliveryStopId.slice(-8),explanation:p.explanation,estCorrect:p.deliveryStopType==="lab_dropoff"})}if(e.find(c=>c.stop_type==="depot_dropoff"||c.stop_type==="depot")){console.log(`
--- ScÃ©nario 2: Laboratoire sans dropoff (depot disponible) ---`);const p=await u("laboratoire-sans-dropoff-id",o.id,e);console.log("âœ… RÃ©sultat scÃ©nario 2:",{deliveryStopType:p.deliveryStopType,deliveryStopId:p.deliveryStopId.slice(-8),explanation:p.explanation,estCorrect:p.deliveryStopType==="depot_dropoff"})}console.log(`
--- ScÃ©nario 3: Aucune destination disponible ---`);const s=await u("laboratoire-aucune-destination-id",o.id,e);console.log("âœ… RÃ©sultat scÃ©nario 3:",{deliveryStopType:s.deliveryStopType,deliveryStopId:s.deliveryStopId.slice(-8),explanation:s.explanation,estCorrect:s.deliveryStopType==="client_same"&&s.deliveryStopId===o.id}),console.log(`
ğŸš€ === TEST CRÃ‰ATION COMPLÃˆTE (SIMULATION) ===`);const d=await g(o.location_id);if(d.length>0){const c=d[0];console.log(`
ğŸ“¦ Test avec laboratoire Ã©ligible rÃ©el:`,{labName:c.name,labId:c.id.slice(-8),clientId:c.laboratory_client_id.slice(-8)}),console.log("âš ï¸ MODE TEST - Simulation de crÃ©ation (pas de vraie insertion DB)");const p=await u(c.id,o.id,e);console.log("âœ… RÃ©sultat simulation crÃ©ation:",{pickupStopId:o.id.slice(-8),deliveryStopId:p.deliveryStopId.slice(-8),deliveryStopType:p.deliveryStopType,wouldBeCompleted:p.deliveryStopType==="client_same",explanation:p.explanation}),console.log(`
ğŸ¯ CONCLUSION DU TEST:`),console.log("âœ… Logique intelligente validÃ©e !"),console.log(`ğŸ“ Pickup: Stop client actuel (${o.id.slice(-8)})`),console.log(`ğŸ“ Delivery: ${p.deliveryStopType} (${p.deliveryStopId.slice(-8)})`),console.log(`ğŸ“ ${p.explanation}`),p.deliveryStopType==="client_same"?console.log("ğŸ”„ Shipment sera automatiquement marquÃ© comme completed"):console.log("â³ Shipment sera en attente de livraison au stop de destination")}else console.log("âŒ Aucun laboratoire Ã©ligible trouvÃ© pour ce stop");console.log(`
âœ… === TEST TERMINÃ‰ AVEC SUCCÃˆS ===`),console.log("ğŸ‰ La logique intelligente fonctionne parfaitement !")}catch(n){console.error("âŒ Erreur pendant le test:",n)}}typeof window<"u"&&(window.testUnexpectedPickup={testEligibleLabs:h,getEligibleLabsForUnexpectedPickup:g,createUnexpectedPickupShipment:S,testCompleteUnexpectedPickupFlow:v,testUnexpectedPickupWithRealData:I,testCreateUnexpectedShipment:E,testUnexpectedPickupNewArchitecture:w,findDeliveryStopForUnexpectedPickup:u,createUnexpectedPickupShipmentSmart:m,createSmartUnexpectedPickup:x,testSmartUnexpectedPickupLogic:L,testRetourInattenduIntelligent:R},window.testRetour=window.testUnexpectedPickup.testRetourInattenduIntelligent);export{x as createSmartUnexpectedPickup,S as createUnexpectedPickupShipment,m as createUnexpectedPickupShipmentSmart,u as findDeliveryStopForUnexpectedPickup,T as findLaboratoryClientId,g as getEligibleLabsForUnexpectedPickup,v as testCompleteUnexpectedPickupFlow,E as testCreateUnexpectedShipment,h as testEligibleLabs,R as testRetourInattenduIntelligent,L as testSmartUnexpectedPickupLogic,w as testUnexpectedPickupNewArchitecture,I as testUnexpectedPickupWithRealData};
